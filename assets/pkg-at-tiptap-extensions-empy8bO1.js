import{E as u,y as w,z as v,C as P,d as S}from"./pkg-at-tiptap-core-DNbHC1Gn.js";import{P as p,d as m,ab as z,W as f,V as g,ac as E,ad as N,ae as M,af as O}from"./editor-C-B7di21.js";u.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=e=>{const t=e?.node||this.editor.state.doc;if((e?.mode||this.options.mode)==="textSize"){const r=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(r)}return t.nodeSize},this.storage.words=e=>{const t=e?.node||this.editor.state.doc,s=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(s)}},addProseMirrorPlugins(){let e=!1;return[new p({key:new m("characterCount"),appendTransaction:(t,s,r)=>{if(e)return;const o=this.options.limit;if(o==null||o===0){e=!0;return}const n=this.storage.characters({node:r.doc});if(n>o){const i=n-o,a=0,d=i;console.warn(`[CharacterCount] Initial content exceeded limit of ${o} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,d);return e=!0,c}e=!0},filterTransaction:(t,s)=>{const r=this.options.limit;if(!t.docChanged||r===0||r===null||r===void 0)return!0;const o=this.storage.characters({node:s.doc}),n=this.storage.characters({node:t.doc});if(n<=r||o>r&&n>r&&n<=o)return!0;if(o>r&&n>r&&n>o||!t.getMeta("paste"))return!1;const a=t.selection.$head.pos,d=n-r,c=a-d,l=a;return t.deleteRange(c,l),!(this.storage.characters({node:t.doc})>r)}})]}});var b=u.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[z(this.options)]}});u.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new p({key:new m("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:s,isFocused:r}=this.editor,{anchor:o}=t,n=[];if(!s||!r)return f.create(e,[]);let i=0;this.options.mode==="deepest"&&e.descendants((d,c)=>{if(d.isText)return;if(!(o>=c&&o<=c+d.nodeSize-1))return!1;i+=1});let a=0;return e.descendants((d,c)=>{if(d.isText||!(o>=c&&o<=c+d.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&i-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";n.push(g.node(c,c+d.nodeSize,{class:this.options.className}))}),f.create(e,n)}}})]}});var D=u.create({name:"gapCursor",addProseMirrorPlugins(){return[E()]},extendNodeSchema(e){var t;const s={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=w(v(e,"allowGapCursor",s)))!=null?t:null}}}),A=u.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new p({key:new m("placeholder"),props:{decorations:({doc:e,selection:t})=>{const s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=t,o=[];if(!s)return null;const n=this.editor.isEmpty;return e.descendants((i,a)=>{const d=r>=a&&r<=a+i.nodeSize,c=!i.isLeaf&&P(i);if((d||!this.options.showOnlyCurrent)&&c){const l=[this.options.emptyNodeClass];n&&l.push(this.options.emptyEditorClass);const h=g.node(a,a+i.nodeSize,{class:l.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:i,pos:a,hasAnchor:d}):this.options.placeholder});o.push(h)}return this.options.includeChildren}),f.create(e,o)}}})]}});u.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new p({key:new m("selection"),props:{decorations(s){return s.selection.empty||e.isFocused||!e.isEditable||S(s.selection)||e.view.dragging?null:f.create(s.doc,[g.inline(s.selection.from,s.selection.to,{class:t.className})])}}})]}});function y({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||t?.type===e}var _=u.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var e;const t=new m(this.name),s=((e=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:e.name)||this.options.node||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,o])=>o).filter(o=>(this.options.notAfter||[]).concat(s).includes(o.name));return[new p({key:t,appendTransaction:(o,n,i)=>{const{doc:a,tr:d,schema:c}=i,l=t.getState(i),h=a.content.size,C=c.nodes[s];if(l)return d.insert(h,C.create())},state:{init:(o,n)=>{const i=n.tr.doc.lastChild;return!y({node:i,types:r})},apply:(o,n)=>{if(!o.docChanged)return n;const i=o.doc.lastChild;return!y({node:i,types:r})}}})]}}),k=u.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>O(e,t),redo:()=>({state:e,dispatch:t})=>M(e,t)}},addProseMirrorPlugins(){return[N(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});export{b as D,D as G,A as P,_ as T,k as U};
