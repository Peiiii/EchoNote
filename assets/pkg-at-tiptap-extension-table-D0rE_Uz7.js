import{N as y,m as M,u as $,v as _,E as O,x as k}from"./pkg-at-tiptap-core-CNcZYZee.js";import{U as I,V as P,W as S,X as z,Y as H,Z as D,_ as R,$ as v,a0 as V,a1 as W,a2 as j,a3 as B,a4 as K,a5 as F,a6 as U,a7 as q,a8 as G,b as X}from"./editor-CPE0OFX2.js";var Y=y.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{var t,r;const l=e.getAttribute("colwidth"),d=l?l.split(",").map(n=>parseInt(n,10)):null;if(!d){const n=(t=e.closest("table"))==null?void 0:t.querySelectorAll("colgroup > col"),u=Array.from(((r=e.parentElement)==null?void 0:r.children)||[]).indexOf(e);if(u&&u>-1&&n&&n[u]){const s=n[u].getAttribute("width");return s?[parseInt(s,10)]:null}}return d}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",M(this.options.HTMLAttributes,e),0]}}),Z=y.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(l=>parseInt(l,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",M(this.options.HTMLAttributes,e),0]}}),J=y.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",M(this.options.HTMLAttributes,e),0]}});function x(e,t){return t?["width",`${Math.max(t,e)}px`]:["min-width",`${e}px`]}function E(e,t,r,l,d,n){var u;let s=0,f=!0,i=t.firstChild;const b=e.firstChild;if(b!==null)for(let p=0,C=0;p<b.childCount;p+=1){const{colspan:w,colwidth:a}=b.child(p).attrs;for(let c=0;c<w;c+=1,C+=1){const o=d===C?n:a&&a[c],m=o?`${o}px`:"";if(s+=o||l,o||(f=!1),i){if(i.style.width!==m){const[h,g]=x(l,o);i.style.setProperty(h,g)}i=i.nextSibling}else{const h=document.createElement("col"),[g,A]=x(l,o);h.style.setProperty(g,A),t.appendChild(h)}}}for(;i;){const p=i.nextSibling;(u=i.parentNode)==null||u.removeChild(i),i=p}f?(r.style.width=`${s}px`,r.style.minWidth=""):(r.style.width="",r.style.minWidth=`${s}px`)}var Q=class{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),E(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,E(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){const t=e.target,r=this.dom.contains(t),l=this.contentDOM.contains(t);return!!(r&&!l&&(e.type==="attributes"||e.type==="childList"||e.type==="characterData"))}};function ee(e,t,r,l){let d=0,n=!0;const u=[],s=e.firstChild;if(!s)return{};for(let p=0,C=0;p<s.childCount;p+=1){const{colspan:w,colwidth:a}=s.child(p).attrs;for(let c=0;c<w;c+=1,C+=1){const o=r===C?l:a&&a[c];d+=o||t,o||(n=!1);const[m,h]=x(t,o);u.push(["col",{style:`${m}: ${h}`}])}}const f=n?`${d}px`:"",i=n?"":`${d}px`;return{colgroup:["colgroup",{},...u],tableWidth:f,tableMinWidth:i}}function L(e,t){return e.createAndFill()}function te(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(r=>{const l=e.nodes[r];l.spec.tableRole&&(t[l.spec.tableRole]=l)}),e.cached.tableNodeTypes=t,t}function le(e,t,r,l,d){const n=te(e),u=[],s=[];for(let i=0;i<r;i+=1){const b=L(n.cell);if(b&&s.push(b),l){const p=L(n.header_cell);p&&u.push(p)}}const f=[];for(let i=0;i<t;i+=1)f.push(n.row.createChecked(null,l&&i===0?u:s));return n.table.createChecked(null,f)}function re(e){return e instanceof S}var T=({editor:e})=>{const{selection:t}=e.state;if(!re(t))return!1;let r=0;const l=k(t.ranges[0].$from,n=>n.type.name==="table");return l?.node.descendants(n=>{if(n.type.name==="table")return!1;["tableCell","tableHeader"].includes(n.type.name)&&(r+=1)}),r===t.ranges.length?(e.commands.deleteTable(),!0):!1},ne="";function oe(e){return(e||"").replace(/\s+/g," ").trim()}function ae(e,t,r={}){var l;const d=(l=r.cellLineSeparator)!=null?l:ne;if(!e||!e.content||e.content.length===0)return"";const n=[];e.content.forEach(a=>{const c=[];a.content&&a.content.forEach(o=>{let m="";o.content&&Array.isArray(o.content)&&o.content.length>1?m=o.content.map(N=>t.renderChildren(N)).join(d):m=o.content?t.renderChildren(o.content):"";const h=oe(m),g=o.type==="tableHeader";c.push({text:h,isHeader:g})}),n.push(c)});const u=n.reduce((a,c)=>Math.max(a,c.length),0);if(u===0)return"";const s=new Array(u).fill(0);n.forEach(a=>{var c;for(let o=0;o<u;o+=1){const h=(((c=a[o])==null?void 0:c.text)||"").length;h>s[o]&&(s[o]=h),s[o]<3&&(s[o]=3)}});const f=(a,c)=>a+" ".repeat(Math.max(0,c-a.length)),i=n[0],b=i.some(a=>a.isHeader);let p=`
`;const C=new Array(u).fill(0).map((a,c)=>b&&i[c]&&i[c].text||"");return p+=`| ${C.map((a,c)=>f(a,s[c])).join(" | ")} |
`,p+=`| ${s.map(a=>"-".repeat(Math.max(3,a))).join(" | ")} |
`,(b?n.slice(1):n).forEach(a=>{p+=`| ${new Array(u).fill(0).map((c,o)=>f(a[o]&&a[o].text||"",s[o])).join(" | ")} |
`}),p}var se=ae,ie=y.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:Q,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:e,HTMLAttributes:t}){const{colgroup:r,tableWidth:l,tableMinWidth:d}=ee(e,this.options.cellMinWidth);return["table",M(this.options.HTMLAttributes,t,{style:l?`width: ${l}`:`min-width: ${d}`}),r,["tbody",0]]},parseMarkdown:(e,t)=>{const r=[];if(e.header){const l=[];e.header.forEach(d=>{l.push(t.createNode("tableHeader",{},[{type:"paragraph",content:t.parseInline(d.tokens)}]))}),r.push(t.createNode("tableRow",{},l))}return e.rows&&e.rows.forEach(l=>{const d=[];l.forEach(n=>{d.push(t.createNode("tableCell",{},[{type:"paragraph",content:t.parseInline(n.tokens)}]))}),r.push(t.createNode("tableRow",{},d))}),t.createNode("table",void 0,r)},renderMarkdown:(e,t)=>se(e,t),addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:r=!0}={})=>({tr:l,dispatch:d,editor:n})=>{const u=le(n.schema,e,t,r);if(d){const s=l.selection.from+1;l.replaceSelectionWith(u).scrollIntoView().setSelection(X.near(l.doc.resolve(s)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>G(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>q(e,t),deleteColumn:()=>({state:e,dispatch:t})=>U(e,t),addRowBefore:()=>({state:e,dispatch:t})=>F(e,t),addRowAfter:()=>({state:e,dispatch:t})=>K(e,t),deleteRow:()=>({state:e,dispatch:t})=>B(e,t),deleteTable:()=>({state:e,dispatch:t})=>j(e,t),mergeCells:()=>({state:e,dispatch:t})=>R(e,t),splitCell:()=>({state:e,dispatch:t})=>v(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>W("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>W("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>V(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>R(e,t)?!0:v(e,t),setCellAttribute:(e,t)=>({state:r,dispatch:l})=>D(e,t)(r,l),goToNextCell:()=>({state:e,dispatch:t})=>H(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>H(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&z(e),!0),setCellSelection:e=>({tr:t,dispatch:r})=>{if(r){const l=S.create(t.doc,e.anchorCell,e.headCell);t.setSelection(l)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:T,"Mod-Backspace":T,Delete:T,"Mod-Delete":T}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[I({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],P({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:$(_(e,"tableRole",t))}}});O.create({name:"tableKit",addExtensions(){const e=[];return this.options.table!==!1&&e.push(ie.configure(this.options.table)),this.options.tableCell!==!1&&e.push(Y.configure(this.options.tableCell)),this.options.tableHeader!==!1&&e.push(Z.configure(this.options.tableHeader)),this.options.tableRow!==!1&&e.push(J.configure(this.options.tableRow)),e}});export{Y as T,Z as a,J as b,ie as c};
