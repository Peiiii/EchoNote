---
alwaysApply: true
description: "Component Architecture Principles - Separation of concerns and clean architecture"
---

# ç»„ä»¶æ¶æ„åŸåˆ™

## æ ¸å¿ƒåŸåˆ™ï¼šå…³æ³¨ç‚¹åˆ†ç¦»

### ğŸ¯ **çº¯å±•ç¤ºç»„ä»¶ï¼ˆPure Presentation Componentsï¼‰**

çº¯å±•ç¤ºç»„ä»¶å¿…é¡»ä¿æŒæ— çŠ¶æ€ï¼Œä¸åº”è¯¥ç›´æ¥å¼•ç”¨ä»»ä½• store æˆ–å…¨å±€çŠ¶æ€ã€‚

#### âœ… **æ­£ç¡®åšæ³•**
```tsx
// âœ… çº¯å±•ç¤ºç»„ä»¶ï¼šé€šè¿‡ props æ¥æ”¶æ‰€æœ‰æ•°æ®
interface CollapsibleSidebarProps {
  collapsed?: boolean;
  onCollapseChange?: (collapsed: boolean) => void;
  children: ReactNode;
}

export const CollapsibleSidebar = ({ 
  collapsed, 
  onCollapseChange, 
  children 
}: CollapsibleSidebarProps) => {
  // åªå¤„ç† UI é€»è¾‘ï¼Œä¸å¼•ç”¨ä»»ä½• store
  const [internalState, setInternalState] = useState(false);
  const isCollapsed = collapsed ?? internalState;
  
  return (
    <div className={isCollapsed ? "collapsed" : "expanded"}>
      {children}
    </div>
  );
};
```

#### âŒ **é”™è¯¯åšæ³•**
```tsx
// âŒ çº¯å±•ç¤ºç»„ä»¶ç›´æ¥å¼•ç”¨ store
import { useViewStateStore } from "@/core/stores/view-state.store";

export const CollapsibleSidebar = ({ children }: Props) => {
  // è¿ååŸåˆ™ï¼šçº¯å±•ç¤ºç»„ä»¶ä¸åº”è¯¥çŸ¥é“ store çš„å­˜åœ¨
  const { isCollapsed, toggleSidebar } = useViewStateStore();
  
  return <div>{children}</div>;
};
```

### ğŸ”„ **å®¹å™¨ç»„ä»¶ï¼ˆContainer Componentsï¼‰**

å®¹å™¨ç»„ä»¶è´Ÿè´£è¿æ¥ store å’Œçº¯å±•ç¤ºç»„ä»¶ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†ã€‚

#### âœ… **æ­£ç¡®åšæ³•**
```tsx
// âœ… å®¹å™¨ç»„ä»¶ï¼šè¿æ¥ store å’Œçº¯å±•ç¤ºç»„ä»¶
export const LeftSidebar = ({ children }: Props) => {
  const { isCollapsed, setCollapsed } = useViewStateStore();
  
  const handleCollapseChange = (collapsed: boolean) => {
    setCollapsed(collapsed);
  };

  return (
    <CollapsibleSidebar
      collapsed={isCollapsed}
      onCollapseChange={handleCollapseChange}
    >
      {children}
    </CollapsibleSidebar>
  );
};
```

## ç»„ä»¶åˆ†å±‚æ¶æ„

### ç¬¬ä¸€å±‚ï¼šUI ç»„ä»¶ (Pure Presentation)
- **èŒè´£**ï¼šçº¯ UI æ¸²æŸ“ï¼Œæ ·å¼æ§åˆ¶
- **ç‰¹å¾**ï¼šæ— ä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡ props æ¥æ”¶æ•°æ®
- **ä½ç½®**ï¼š`@/common/components/ui/`
- **ç¤ºä¾‹**ï¼šButton, Input, Modal, Card

#### âš ï¸ **UI ç»„ä»¶ç¦æ­¢ä¾èµ–ä¸šåŠ¡é€»è¾‘**

UI ç»„ä»¶å¿…é¡»ä¿æŒçº¯ç²¹ï¼Œ**ä¸åº”è¯¥æ„ŸçŸ¥ä»»ä½•ä¸šåŠ¡é€»è¾‘**ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š
- âŒ **å›½é™…åŒ–ï¼ˆi18nï¼‰**ï¼šä¸åº”è¯¥ä½¿ç”¨ `useTranslation`ï¼Œä¸åº”è¯¥æ¥æ”¶ `titleKey`ã€`labelKey` ç­‰
- âŒ **çŠ¶æ€ç®¡ç†**ï¼šä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ storeã€context
- âŒ **ä¸šåŠ¡æœåŠ¡**ï¼šä¸åº”è¯¥è°ƒç”¨ä¸šåŠ¡æœåŠ¡æˆ– API
- âŒ **ä¸šåŠ¡ç±»å‹**ï¼šä¸åº”è¯¥ä¾èµ–ä¸šåŠ¡ç‰¹å®šçš„ç±»å‹å®šä¹‰

#### âœ… **æ­£ç¡®åšæ³•ï¼šæ¥æ”¶å·²å¤„ç†çš„æ•°æ®**

```tsx
// âœ… UI ç»„ä»¶ï¼šæ¥æ”¶å·²ç¿»è¯‘çš„æ–‡æœ¬
interface IconButtonProps {
  icon: LucideIcon;
  onClick: () => void;
  title: string;           // æ¥æ”¶å·²ç¿»è¯‘çš„æ–‡æœ¬
  ariaLabel?: string;      // æ¥æ”¶å·²ç¿»è¯‘çš„æ–‡æœ¬
}

export function IconButton({ icon: Icon, onClick, title, ariaLabel }: IconButtonProps) {
  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={onClick}
      title={title}              // ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„æ–‡æœ¬
      aria-label={ariaLabel ?? title}
    >
      <Icon className="h-4 w-4" />
    </Button>
  );
}
```

#### âŒ **é”™è¯¯åšæ³•ï¼šåœ¨ UI ç»„ä»¶ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘**

```tsx
// âŒ é”™è¯¯ï¼šUI ç»„ä»¶æ„ŸçŸ¥ i18n
import { useTranslation } from "react-i18next";

interface IconButtonProps {
  icon: LucideIcon;
  onClick: () => void;
  titleKey: string;        // âŒ æ¥æ”¶ i18n key
  ariaLabelKey?: string;    // âŒ æ¥æ”¶ i18n key
}

export function IconButton({ icon: Icon, onClick, titleKey, ariaLabelKey }: IconButtonProps) {
  const { t } = useTranslation();  // âŒ UI ç»„ä»¶ä¸åº”è¯¥ä½¿ç”¨ i18n
  const title = t(titleKey);      // âŒ UI ç»„ä»¶ä¸åº”è¯¥å¤„ç†ç¿»è¯‘
  
  return <Button title={title}>...</Button>;
}
```

#### âœ… **æ­£ç¡®åšæ³•ï¼šåœ¨å®¹å™¨ç»„ä»¶ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘**

```tsx
// âœ… å®¹å™¨ç»„ä»¶ï¼šå¤„ç† i18nï¼Œç„¶åä¼ ç»™ UI ç»„ä»¶
export const ChannelHeader = () => {
  const { t } = useTranslation();  // âœ… å®¹å™¨ç»„ä»¶å¯ä»¥ä½¿ç”¨ i18n
  
  return (
    <div>
      <IconButton
        icon={Bot}
        onClick={() => presenter.openAIAssistant()}
        title={t("channelHeader.aiAssistant")}  // âœ… åœ¨å¤–éƒ¨ç¿»è¯‘åä¼ å…¥
      />
    </div>
  );
};
```

#### ğŸ“‹ **UI ç»„ä»¶è®¾è®¡æ£€æŸ¥æ¸…å•**

åœ¨åˆ›å»ºæˆ–ä¿®æ”¹ UI ç»„ä»¶æ—¶ï¼Œæ£€æŸ¥ï¼š
- [ ] ç»„ä»¶æ˜¯å¦åœ¨ `@/common/components/ui/` ç›®å½•ä¸‹ï¼Ÿ
- [ ] ç»„ä»¶æ˜¯å¦åªæ¥æ”¶åŸå§‹æ•°æ®ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼‰ï¼Ÿ
- [ ] ç»„ä»¶æ˜¯å¦æ²¡æœ‰ä½¿ç”¨ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„ hooksï¼ˆ`useTranslation`ã€`useStore` ç­‰ï¼‰ï¼Ÿ
- [ ] ç»„ä»¶æ˜¯å¦æ²¡æœ‰å¯¼å…¥ä»»ä½•ä¸šåŠ¡æœåŠ¡æˆ– storeï¼Ÿ
- [ ] ç»„ä»¶æ˜¯å¦å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨ï¼ˆä¸ä¾èµ–ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼‰ï¼Ÿ
- [ ] ç»„ä»¶æ˜¯å¦åªè´Ÿè´£å±•ç¤ºå’ŒåŸºæœ¬çš„äº¤äº’ï¼ˆç‚¹å‡»ã€æ‚¬åœç­‰ï¼‰ï¼Ÿ

```tsx
// âœ… UI ç»„ä»¶ç¤ºä¾‹
export const Button = ({ 
  variant, 
  size, 
  onClick, 
  children 
}: ButtonProps) => (
  <button 
    className={buttonVariants({ variant, size })}
    onClick={onClick}
  >
    {children}
  </button>
);
```

### ç¬¬äºŒå±‚ï¼šä¸šåŠ¡ç»„ä»¶ (Business Components)  
- **èŒè´£**ï¼šç‰¹å®šä¸šåŠ¡é€»è¾‘çš„å±•ç¤º
- **ç‰¹å¾**ï¼šå¯èƒ½åŒ…å«è½»é‡ä¸šåŠ¡é€»è¾‘ï¼Œä½†ä¸ç›´æ¥è®¿é—®å…¨å±€çŠ¶æ€
- **ä½ç½®**ï¼š`@/common/components/`
- **ç¤ºä¾‹**ï¼šCollapsibleSidebar, MessageTimeline, ChannelItem

```tsx
// âœ… ä¸šåŠ¡ç»„ä»¶ç¤ºä¾‹
export const CollapsibleSidebar = ({ 
  collapsed, 
  onCollapseChange 
}: Props) => {
  // å†…éƒ¨çŠ¶æ€ç®¡ç†ï¼Œä½†ä¸è®¿é—®å…¨å±€ store
  const [internalState, setInternalState] = useState(false);
  
  return <div>{/* UI é€»è¾‘ */}</div>;
};
```

### ç¬¬ä¸‰å±‚ï¼šå®¹å™¨ç»„ä»¶ (Container Components)
- **èŒè´£**ï¼šè¿æ¥ storeï¼Œå¤„ç†æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†
- **ç‰¹å¾**ï¼šè®¿é—®å…¨å±€çŠ¶æ€ï¼Œåè°ƒå¤šä¸ªç»„ä»¶
- **ä½ç½®**ï¼š`@/desktop/features/[feature]/components/`
- **ç¤ºä¾‹**ï¼šLeftSidebar, ChatLayout, MessageContainer

```tsx
// âœ… å®¹å™¨ç»„ä»¶ç¤ºä¾‹
export const LeftSidebar = ({ children }: Props) => {
  const { isCollapsed, setCollapsed } = useViewStateStore();
  const { channels } = useChatDataStore();
  
  return (
    <CollapsibleSidebar 
      collapsed={isCollapsed}
      onCollapseChange={setCollapsed}
    >
      {children}
    </CollapsibleSidebar>
  );
};
```

### ç¬¬å››å±‚ï¼šé¡µé¢ç»„ä»¶ (Page Components)
- **èŒè´£**ï¼šé¡µé¢çº§åˆ«çš„å¸ƒå±€å’Œæ•°æ®ç¼–æ’
- **ç‰¹å¾**ï¼šç»„åˆå¤šä¸ªå®¹å™¨ç»„ä»¶ï¼Œå¤„ç†è·¯ç”±
- **ä½ç½®**ï¼š`@/desktop/features/[feature]/pages/`
- **ç¤ºä¾‹**ï¼šChatPage, SettingsPage, DashboardPage

```tsx
// âœ… é¡µé¢ç»„ä»¶ç¤ºä¾‹
export const ChatPage = () => {
  return (
    <ChatLayout
      sidebar={<LeftSidebar><ChannelList /></LeftSidebar>}
      content={<ChatContent />}
      rightSidebar={<ThreadSidebar />}
    />
  );
};
```

## æ•°æ®æµå‘åŸåˆ™

### ğŸ“¥ **å‘ä¸‹ä¼ é€’æ•°æ®ï¼ˆProps Downï¼‰**
```tsx
// Store â†’ Container â†’ Business Component â†’ UI Component
Store (useViewStateStore)
  â†“ props
Container (LeftSidebar) 
  â†“ props
Business Component (CollapsibleSidebar)
  â†“ props  
UI Component (Button)
```

### ğŸ“¤ **å‘ä¸Šä¼ é€’äº‹ä»¶ï¼ˆEvents Upï¼‰**
```tsx
// UI Component â†’ Business Component â†’ Container â†’ Store
UI Component (onClick)
  â†‘ event
Business Component (onCollapseChange)
  â†‘ event
Container (handleCollapseChange)
  â†‘ store action
Store (setCollapsed)
```

## Store ä½¿ç”¨è§„åˆ™

### âœ… **å…è®¸ä½¿ç”¨ Store çš„ç»„ä»¶**
1. **å®¹å™¨ç»„ä»¶**ï¼šç›´æ¥è¿æ¥ store å’Œå±•ç¤ºç»„ä»¶
2. **é¡µé¢ç»„ä»¶**ï¼šé¡µé¢çº§åˆ«çš„çŠ¶æ€ç®¡ç†
3. **ä¸šåŠ¡é’©å­**ï¼šcustom hooks å¯ä»¥å°è£… store é€»è¾‘

### âŒ **ç¦æ­¢ä½¿ç”¨ Store çš„ç»„ä»¶**
1. **UI ç»„ä»¶**ï¼š`@/common/components/ui/` ä¸‹çš„æ‰€æœ‰ç»„ä»¶
2. **çº¯å±•ç¤ºç»„ä»¶**ï¼šåªè´Ÿè´£æ¸²æŸ“çš„ä¸šåŠ¡ç»„ä»¶
3. **ç¬¬ä¸‰æ–¹ç»„ä»¶å°è£…**ï¼šå¯¹å¤–éƒ¨åº“çš„ç®€å•å°è£…

### ğŸ”§ **Store ä½¿ç”¨ç¤ºä¾‹**

#### âœ… **æ­£ç¡®ï¼šåœ¨å®¹å™¨ç»„ä»¶ä¸­ä½¿ç”¨**
```tsx
// src/desktop/features/chat/components/sidebar/left-sidebar.tsx
export const LeftSidebar = () => {
  const { isCollapsed, setCollapsed } = useViewStateStore(); // âœ… å®¹å™¨ç»„ä»¶å¯ä»¥ä½¿ç”¨
  
  return (
    <CollapsibleSidebar 
      collapsed={isCollapsed}
      onCollapseChange={setCollapsed}
    />
  );
};
```

#### âŒ **é”™è¯¯ï¼šåœ¨çº¯å±•ç¤ºç»„ä»¶ä¸­ä½¿ç”¨**
```tsx
// src/common/components/collapsible-sidebar/collapsible-sidebar.tsx
export const CollapsibleSidebar = () => {
  const { isCollapsed } = useViewStateStore(); // âŒ çº¯å±•ç¤ºç»„ä»¶ä¸èƒ½ä½¿ç”¨ store
  
  return <div />;
};
```

#### âœ… **æ­£ç¡®ï¼šé€šè¿‡è‡ªå®šä¹‰ Hook å°è£…**
```tsx
// src/desktop/features/chat/hooks/use-sidebar-state.ts
export const useSidebarState = () => {
  const { isCollapsed, setCollapsed } = useViewStateStore();
  
  return {
    isCollapsed,
    toggleSidebar: () => setCollapsed(!isCollapsed),
    collapseSidebar: () => setCollapsed(true),
    expandSidebar: () => setCollapsed(false),
  };
};
```

## ç»„ä»¶æµ‹è¯•ç­–ç•¥

### UI ç»„ä»¶æµ‹è¯•
- **å·¥å…·**ï¼š@testing-library/react
- **é‡ç‚¹**ï¼šProps æ¸²æŸ“ã€äº¤äº’äº‹ä»¶ã€æ ·å¼çŠ¶æ€
- **Mock**ï¼šä¸éœ€è¦ mock store

### ä¸šåŠ¡ç»„ä»¶æµ‹è¯•  
- **å·¥å…·**ï¼š@testing-library/react + jest
- **é‡ç‚¹**ï¼šä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€å˜åŒ–ã€å›è°ƒè§¦å‘
- **Mock**ï¼šMock å¤–éƒ¨ä¾èµ–ï¼Œä¸ mock store

### å®¹å™¨ç»„ä»¶æµ‹è¯•
- **å·¥å…·**ï¼š@testing-library/react + MSW
- **é‡ç‚¹**ï¼šStore é›†æˆã€æ•°æ®æµã€ç”¨æˆ·äº¤äº’
- **Mock**ï¼šMock store æˆ–ä½¿ç”¨çœŸå® store

## é‡æ„æŒ‡å¯¼

### è¯†åˆ«éœ€è¦é‡æ„çš„ç»„ä»¶
1. **æ··åˆèŒè´£**ï¼šåŒæ—¶å¤„ç† UI å’ŒçŠ¶æ€ç®¡ç†
2. **ç›´æ¥è®¿é—® Store**ï¼šçº¯å±•ç¤ºç»„ä»¶å¼•ç”¨ store
3. **å¤æ‚ä¾èµ–**ï¼šç»„ä»¶ä¾èµ–è¿‡å¤šå¤–éƒ¨çŠ¶æ€

### é‡æ„æ­¥éª¤
1. **åˆ†æèŒè´£**ï¼šè¯†åˆ« UI é€»è¾‘å’Œä¸šåŠ¡é€»è¾‘
2. **æå–çŠ¶æ€**ï¼šå°† store é€»è¾‘ç§»åˆ°å®¹å™¨ç»„ä»¶
3. **å®šä¹‰æ¥å£**ï¼šæ˜ç¡® props å’Œå›è°ƒæ¥å£
4. **é€æ­¥è¿ç§»**ï¼šä¿æŒå‘åå…¼å®¹æ€§
5. **æ›´æ–°æµ‹è¯•**ï¼šè°ƒæ•´æµ‹è¯•ç­–ç•¥

## æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•

### æ–°ç»„ä»¶å¼€å‘
- [ ] æ˜ç¡®ç»„ä»¶èŒè´£å’Œåˆ†å±‚
- [ ] UI ç»„ä»¶ä¸å¼•ç”¨ä»»ä½• store
- [ ] å®¹å™¨ç»„ä»¶è´Ÿè´£çŠ¶æ€ç®¡ç†
- [ ] Props æ¥å£è®¾è®¡åˆç†
- [ ] äº‹ä»¶å›è°ƒå‘½åæ¸…æ™°

### ä»£ç å®¡æŸ¥è¦ç‚¹
- [ ] ç»„ä»¶åˆ†å±‚æ˜¯å¦æ¸…æ™°
- [ ] Store ä½¿ç”¨æ˜¯å¦åˆè§„
- [ ] Props è®¾è®¡æ˜¯å¦åˆç†
- [ ] æ˜¯å¦è¿åå•ä¸€èŒè´£åŸåˆ™
- [ ] æµ‹è¯•ç­–ç•¥æ˜¯å¦é€‚å½“

---

**è®°ä½**ï¼šå¥½çš„ç»„ä»¶æ¶æ„æ˜¯å¯æµ‹è¯•ã€å¯å¤ç”¨ã€å¯ç»´æŠ¤çš„ã€‚éµå¾ªè¿™äº›åŸåˆ™å¯ä»¥è®©ä»£ç æ›´åŠ æ¸…æ™°å’Œå¥å£®ã€‚